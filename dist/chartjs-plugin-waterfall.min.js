!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lodash/merge"),require("lodash/groupBy")):"function"==typeof define&&define.amd?define(["lodash/merge","lodash/groupBy"],e):t.chartjsPluginWaterfall=e(t.merge,t.groupBy)}(this,function(e,d){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,d=d&&d.hasOwnProperty("default")?d.default:d;!function(){function l(t){this.value=t}function t(n){var r,s;function i(t,e){try{var o=n[t](e),a=o.value;a instanceof l?Promise.resolve(a.value).then(function(t){i("next",t)},function(t){i("throw",t)}):u(o.done?"return":"normal",o.value)}catch(t){u("throw",t)}}function u(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?i(r.key,r.arg):s=null}this._invoke=function(a,n){return new Promise(function(t,e){var o={key:a,arg:n,resolve:t,reject:e,next:null};s?s=s.next=o:(r=s=o,i(a,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var k=function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)},y=function(t,e,o,a){var n=o.stackBase,r=a.stackBase,s=o.stackTopYPos,i=a.stackTopYPos;s===r?(i=r,r=a.dummyStackBase):n===i&&(s=n,n=o.dummyStackBase),!o.isPositive&&a.isPositive&&(i=r,r=a.stackTopYPos),o.isPositive&&!a.isPositive&&(s=n,n=o.stackTopYPos);var u=i<s?s:i,l=r<n?n:r,c=t.createLinearGradient(0,u,0,l),f=o.options.startColor||e.startColor,p=o.options.endColor||e.endColor,d=o.options.startColorStop||e.startColorStop,k=o.options.endColorStop||e.endColorStop;c.addColorStop(d,f),c.addColorStop(k,p),t.fillStyle=c,t.beginPath(),t.lineTo(o.stackRightXPos,s),t.lineTo(a.stackLeftXPos,i),t.lineTo(a.stackLeftXPos,r),t.lineTo(o.stackRightXPos,n),t.fill()},o={waterFallPlugin:{stepLines:{enabled:!0,startColorStop:0,endColorStop:.6,startColor:"rgba(0, 0, 0, 0.55)",endColor:"rgba(0, 0, 0, 0)"}}},a={},n=function(t,e){return!e.datasets[t.datasetIndex].waterfall.dummyStack},r=function(t){t.data.datasets.forEach(function(t){t.waterfall=e({},{stepLines:{}},t.waterfall),t.waterfall.dummyStack&&(t.backgroundColor="rgba(0, 0, 0, 0)")})};return{beforeInit:function(t){a[t.id]={readyToDrawStepLines:!1}},afterInit:function(t){r(t),t.options.plugins=e({},o,t.options.plugins),t.options.tooltips.filter=n,t.options.legend.labels.filter=n,setTimeout(function(){a[t.id].readyToDrawStepLines=!0,null!==t.ctx&&t.draw()},t.options.animation.duration)},afterDraw:function(t){var e=t.options.plugins.waterFallPlugin;r(t),e.stepLines.enabled&&a[t.id].readyToDrawStepLines&&function(t){var e=t.ctx,o=t.data.datasets,a=t.options.plugins.waterFallPlugin.stepLines,i=d(o,"stack"),u=[],l=function(t){var e=Object.keys(t._meta)[0];return t._meta[e].data[0]._model};Object.keys(i).forEach(function(t){var e=i[t].filter(function(t){return 0!==t.data[0]});if(!e.every(function(t){return t.waterfall.dummyStack})){var o=e.filter(function(t){return!t.waterfall.dummyStack}).map(function(t){return l(t).base}),a=Math.max.apply(Math,k(o)),n=e.map(function(t){return l(t).base}),r=Math.max.apply(Math,k(n)),s=e.map(function(t){var e=l(t);return{stackRightXPos:e.x+e.width/2,stackLeftXPos:e.x-e.width/2,stackTopYPos:e.y,stackBase:a,dummyStackBase:r,isPositive:0<t.data[0],options:t.waterfall.stepLines}});u.push(s)}});for(var n=function(t){var e=t.length-1;return{stackRightXPos:t[e].stackRightXPos,stackLeftXPos:t[e].stackLeftXPos,stackTopYPos:t[e].stackTopYPos,stackBase:t[e].stackBase,dummyStackBase:t[e].dummyStackBase,isPositive:t[e].isPositive,options:t[e].options}},r=0;r<u.length;r+=1){var s=u[r];if(r!==u.length-1){var c=u[r+1],f=n(s),p=n(c);f.stackTopYPos!==p.stackTopYPos&&f.stackBase!==p.stackTopYPos&&f.stackTopYPos!==p.stackBase||y(e,a,f,p)}}}(t)}}});
//# sourceMappingURL=chartjs-plugin-waterfall.min.js.map
